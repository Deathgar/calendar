@using MVC5FullCalandarPlugin.Models
@model List<User>

@helper GeneratePanel(PublicHoliday holiday)
{
     if (holiday.Image != null)
     {
         <img class="img" id="imageDay" src=@holiday.Image.Url style="height: 45%; object-fit: cover;"/>
         <br/>
     }
     else
     {
         <img class="img" id="imageDay" src="https://webref.ru/assets/images/html5-css3/img-04.jpg" style="height: 45%; object-fit: cover;"/>
         <br/>
     }

    <div class="panelWithLabels">
        <label class="labels"> Date: </label> <br/>
        <div class="textLabels date">@holiday.End_Date</div>
        <label class="labels"> Title: </label> <br/>
        <div class="textLabels title">@holiday.Title </div>
        <label class="labels"> Time: </label> <br/>
        <div class="textLabels time">@holiday.Time</div>
        <label class="labels"> Description: </label> <br/>
        <div class="textLabels description">@holiday.Description</div>
    </div>
}


@helper GenerateUser(User user)
{
    <input id="ha" class="btn hovers" type="button" value=@user.Email />
    <div id="ha" class="containerWithPanelsEvent">

        @foreach (var day in user.Days)
        {
            foreach (var holiday in day.PublicHolidays)
            {
                switch (holiday.Status) {
                    case "done":
                        <div class="EventPanel" id=@holiday.Id data-user=@user.Email style=" border: green solid 1px; border-left: green solid 15px;">@GeneratePanel(holiday)</div>
                        break;
                    case "new":
                        <div class="EventPanel" id=@holiday.Id data-user=@user.Email style=" border: greenyellow solid 1px; border-left: greenyellow solid 15px;">@GeneratePanel(holiday)</div>
                        break;
                    case "inProgress":
                        <div class="EventPanel" id=@holiday.Id data-user=@user.Email style=" border: blue solid 1px; border-left: blue solid 15px;">@GeneratePanel(holiday)</div>
                        break;
                    case "end":
                        <div class="EventPanel" id=@holiday.Id data-user=@user.Email style=" border: grey solid 1px; border-left: gray solid 15px;">@GeneratePanel(holiday)</div>
                        break;
                    case "checking":
                        <div class="EventPanel" id=@holiday.Id data-user=@user.Email style=" border: orange solid 1px; border-left: orange solid 15px;">@GeneratePanel(holiday)</div>
                    break;
                default:
                    <div class="EventPanel" id=@holiday.Id data-user=@user.Email style=" border: blue solid 1px; border-left: blue solid 15px;">@GeneratePanel(holiday)</div>
                    break;
            }
        }
    }



    </div>
}

@foreach (var user in Model)
{
    @GenerateUser(user);
            }

<script type="text/javascript">
    $(function () {
        $('.EventPanel').on('click',
            function () {
                var modal = $('#EventPanelInfo');

                modal.modal('show');
                modal.find('#title').val($(this).find(".title").text());
                modal.find('#time').val($(this).find(".time").text());
                modal.find('#description').val($(this).find(".description").text());
                modal.find('#date').val($(this).find(".date").text());
                modal.find('#imageDay').attr('src', $(this).find(".img").attr('src'));
                modal.find('.id').data('id', this.id);
                modal.find('.user').data('class', $(this).data('user'));

            });

        $("#changeAllEvent").click(
            function () {
                var date = $('#date').val();
                var title = $('#title').val();
                var description = $('#description').val();
                var time = $('#time').val();
                var id = $('.id').data('id');
                var user = $('.user').data('class');
                var status = $('#status').val();

                console.log(date);
                console.log(title);
                console.log(description);
                console.log(time);
                console.log(id);
                console.log(user);

                var image = $('#imageButton')[0].files[0];

                var formData = new FormData();


                formData.append("img", image);
                formData.append("title", title);
                formData.append("time", time);
                formData.append("description", description);
                formData.append("email", user);
                formData.append("date", date);
                formData.append("id", id);
                formData.append("status", status);


                $.ajax({
                    url: '/AllEvents/ChangeTimeAndEvent',
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    type: "POST",
                    data: formData,
                    success: function (url) {
                        console.log(url);
                        var panel = $("#" + id);
                        panel.find('.date').text(date);
                        panel.find('.time').text(time);
                        panel.find('.description').text(description);
                        panel.find('.title').text(title);
                        panel.find('#imageDay').attr('src', url);


                        switch (status) {
                            case 'done':
                                panel.css({ 'border': 'green solid 1px', 'border-left': 'green solid 15px' });
                                break;
                            case 'new':
                                panel.css({ 'border': 'greenyellow solid 1px', 'border-left': 'greenyellow solid 15px' });
                                break;
                            case 'inProgress':
                                panel.css({ 'border': 'blue solid 1px', 'border-left': 'blue solid 15px' });
                                break;
                            case 'end':
                                panel.css({ 'border': 'gray solid 1px', 'border-left': 'grey solid 15px' });
                                break;
                            case 'checking':
                                panel.css({ 'border': 'orange solid 1px', 'border-left': 'orange solid 15px' });
                                break;

                            default:
                        }

                        $('#EventPanelInfo').modal('hide');
                    }

                });
            });
    });

</script>



<style>

    @@media screen and (min-width: 1216px) {
        .EventPanel {
            background: aliceblue;
            border: steelblue solid 1px;
            width: 23%;
            height: 354px;
            margin-right: 16px;
            margin-bottom: 1%;
            overflow: auto;
            display: inline-block;
            text-align: center;
            padding-left: 0.4%;
            padding-top: 0.8%;
            padding-bottom: 0.2%;
            padding-right: 0.5%;
        }


        .EventPanel {
            border: blue solid 1px;
            border-left: blue solid 15px;
        }
    }


    @@media (min-width: 991px) and (max-width: 1215px) {
        .EventPanel {
            background: aliceblue;
            border: steelblue solid 1px;
            width: 30%;
            height: 354px;
            margin-right: 16px;
            margin-bottom: 1%;
            overflow: auto;
            display: inline-block;
            text-align: center;
            padding-left: 0.4%;
            padding-top: 0.8%;
            padding-bottom: 0.2%;
            padding-right: 0.5%;
        }


        .EventPanel {
            border: blue solid 1px;
            border-left: blue solid 15px;
        }
    }

    @@media (min-width: 400px) and (max-width: 990px) {
        .EventPanel {
            background: aliceblue;
            border: steelblue solid 1px;
            width: 45%;
            height: 354px;
            margin-right: 16px;
            margin-bottom: 1%;
            overflow: auto;
            display: inline-block;
            text-align: center;
            padding-left: 0.4%;
            padding-top: 0.8%;
            padding-bottom: 0.2%;
            padding-right: 0.5%;
        }


        .EventPanel {
            border: blue solid 1px;
            border-left: blue solid 15px;
        }
    }

    .textLabels {
        margin-left: 10%;
        word-wrap: break-word;
    }

    .panelWithLabels {
        text-align: left;
        width: 97.5%;
        margin-top: 2%;
        margin-left: 1%;
        padding-left: 4%;
        background: lavender;
    }

    

    .colorStatus {
        margin-top: 0;
        background: black;
        width: 100%;
        height: 1%;
    }

    .labels {
        width: 95%;
    }

    .containerWithPanelsEvent {
        margin-top: 5px;
        margin-left: 2%;
        width: 95%;
        height: 600px;
        overflow: auto;
        border: black solid 1px;
        box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.16), 0 2px 10px 0 rgba(0, 0, 0, 0.12);
        padding-left: 2%;
        padding-top: 2%;
        background: #f7f7f7
    }

    .hovers {
        margin-top: 10px;
        width: 100%;
    }

    input {
        max-width: 100%;
    }
</style>
